<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sigma Graph Example</title>
  <style>
    html, body, #sigma-container {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }
  </style>
  <script type="importmap">
  {
    "imports": {
      "sigma": "https://cdn.jsdelivr.net/npm/sigma@3/+esm",
      "graphology": "https://cdn.jsdelivr.net/npm/graphology@0.25.4/+esm",
      "@sigma/node-image": "https://cdn.jsdelivr.net/npm/@sigma/node-image@3/+esm",
      "graphology-layout-forceatlas2": "https://cdn.jsdelivr.net/npm/graphology-layout-forceatlas2@0.10.1/+esm"
    }
  }
  </script>
</head>
<body>
  <div id="sigma-container"></div>

  <script type="module">
    import Sigma from "sigma";
    import Graph from "graphology";
    import { createNodeImageProgram } from "@sigma/node-image";
    import forceAtlas2 from "graphology-layout-forceatlas2";

    const container = document.getElementById("sigma-container");
    const graph = new Graph();

    const RED = "#FA4F40";
    const BLUE = "#727EE0";
    const GREEN = "#5DB346";

    // Noduri
    graph.addNode("John", { size: 15, label: "John", type: "image", image: "./user.svg", color: RED });
    graph.addNode("Mary", { size: 15, label: "Mary", type: "image", image: "./user.svg", color: RED });
    graph.addNode("Suzan", { size: 15, label: "Suzan", type: "image", image: "./user.svg", color: RED });
    graph.addNode("Nantes", { size: 15, label: "Nantes", type: "image", image: "./city.svg", color: BLUE });
    graph.addNode("New-York", { size: 15, label: "New-York", type: "image", image: "./city.svg", color: BLUE });
    graph.addNode("Sushis", { size: 7, label: "Sushis", color: GREEN });
    graph.addNode("Falafels", { size: 7, label: "Falafels", color: GREEN });
    graph.addNode("Kouign Amann", { size: 7, label: "Kouign Amann", color: GREEN });

    // Muchii
    graph.addEdge("John", "Mary", { type: "line", label: "works with", size: 5 });
    graph.addEdge("Mary", "Suzan", { type: "line", label: "works with", size: 5 });
    graph.addEdge("Mary", "Nantes", { type: "arrow", label: "lives in", size: 5 });
    graph.addEdge("John", "New-York", { type: "arrow", label: "lives in", size: 5 });
    graph.addEdge("Suzan", "New-York", { type: "arrow", label: "lives in", size: 5 });
    graph.addEdge("John", "Falafels", { type: "arrow", label: "eats", size: 5 });
    graph.addEdge("Mary", "Sushis", { type: "arrow", label: "eats", size: 5 });
    graph.addEdge("Suzan", "Kouign Amann", { type: "arrow", label: "eats", size: 5 });

    // Poziții inițiale random
    graph.nodes().forEach((node) => {
      graph.setNodeAttribute(node, "x", Math.random() * 200 - 100);
      graph.setNodeAttribute(node, "y", Math.random() * 200 - 100);
    });

    // Rulează layout sincron (200 iterații)
    forceAtlas2.assign(graph, { iterations: 200 });

    // Renderer Sigma
    new Sigma(graph, container, {
      nodeProgramClasses: {
        image: createNodeImageProgram()
      },
      renderEdgeLabels: true,
    });
  </script>
</body>
</html>
